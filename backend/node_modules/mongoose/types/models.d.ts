const { issueItem, getAllIssues, getIssueById } = require("../controllers/issueItem");

const router = express.Router();

router.post("/", async (req, res) => {
    try {
      const { item_id, quantity } = req.body;
  
      const item = await Item.findById(item_id);
      if (!item) {
        return res.status(404).json({ message: "Item not found" });
      }
  
      if (item.quantity < quantity) {
        return res.status(400).json({ message: "Not enough stock available" });
      }
  
      // Deduct the requested quantity
      item.quantity -= quantity;
      const updatedItem = await item.save();
  
      res.json({ message: "Request successful", updatedItem }); // âœ… Ensure updatedItem is sent
    } catch (error) {
      console.error(error);
      res.status(500).json({ message: "Server error" });
    }
  });
  
  
router.get("/", getAllIssues);
router.get("/:id", getIssueById);

